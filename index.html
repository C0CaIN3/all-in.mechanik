<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ALL-IN CORPORATION ‚Äì Pracovn√≠ list</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Urbanist:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#05080e; --bg-2:#0a1220; --text:#e9f2ff; --muted:#9fb0c9;
  --accent:#24a0ff; --card:rgba(10,20,36,.6); --border:#1f2c44;
  --radius:14px; --ring: #1a90ff33;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:linear-gradient(180deg,var(--bg),var(--bg-2)); color:var(--text);}
header{position:sticky;top:0;background:linear-gradient(180deg,rgba(8,14,26,.8),rgba(8,14,26,.5));padding:18px 24px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:center}
.logo{width:44px;height:44px;border-radius:10px;background:conic-gradient(from 120deg,#0ef,#24a0ff,#5ef,#24a0ff);box-shadow:0 8px 30px #24a0ff22}
h1{margin:0;font-size:18px;font-weight:700}
.note{color:var(--muted);font-size:13px}
.main{display:grid;grid-template-columns:1fr 420px;gap:20px;padding:22px;max-width:1300px;margin:0 auto}
@media(max-width:1000px){.main{grid-template-columns:1fr;padding:12px}}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;align-items:center}
.controls input, .controls select{background:rgba(10,18,30,.6);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:10px;outline:none}
.badge{background:linear-gradient(180deg,#081833,#061226);padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-weight:700;color:var(--muted)}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.card{background:linear-gradient(180deg, rgba(6,12,24,.5), rgba(6,12,24,.35));border:1px solid var(--border);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(2,10,30,.5)}
.card h3{margin:0 0 8px;font-size:16px}
.meta{color:var(--muted);font-size:13px;display:flex;gap:8px;flex-wrap:wrap}
.pill{background:rgba(10,22,38,.5);padding:6px 8px;border-radius:999px;border:1px solid #24384f;font-size:12px}
.illegal{background:rgba(255,90,95,.12);border-color:rgba(255,90,95,.35);color:#ffdede}
.semi{background:rgba(255,176,32,.12);border-color:rgba(255,176,32,.35);color:#fff4d6}
.price{font-weight:800;margin-top:8px}
.actions{display:flex;gap:8px;align-items:center;margin-top:10px}
.qty{width:72px;padding:8px;border-radius:8px;border:1px solid var(--border);background:rgba(8,14,24,.6);color:var(--text)}

.aside{background:linear-gradient(180deg, rgba(8,14,26,.7), rgba(8,14,26,.5));border:1px solid var(--border);padding:16px;border-radius:12px;display:flex;flex-direction:column;gap:10px;height:fit-content}
.row{display:flex;gap:8px}
.row input{flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:rgba(6,12,24,.6);color:var(--text)}
.cart-list{max-height:46vh;overflow:auto;padding-top:8px;border-top:1px dashed #20314e;border-bottom:1px dashed #20314e}
.cart-item{display:grid;grid-template-columns:1fr auto;gap:8px;padding:8px 4px;align-items:center}
.sub{color:var(--muted);font-size:13px}
.totals{display:grid;grid-template-columns:1fr auto;row-gap:6px;margin-top:6px}
button{background:linear-gradient(180deg,#2aa8ff,#1984e5);border:none;color:white;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
button.ghost{background:transparent;border:1px solid var(--border);color:var(--text)}

.status{min-height:22px}

.small{font-size:13px;color:var(--muted)}

</style>
</head>
<body>
<header>
  <div style="display:flex;gap:12px;align-items:center"><div class="logo" aria-hidden="true"></div>
  <div><h1> ALL-IN CORPORATION ‚Äì Pracovn√≠ list</h1><div class="note">Slou≈æ√≠ jako evidence pr√°ce mechanika. Do listu se zapisuj√≠ v≈°echny √∫pravy, pou≈æit√Ω materi√°l a cena, aby mƒõl z√°kazn√≠k i firma jasn√Ω p≈ôehled.</div></div></div>
</header>

<main class="main">
  <section>
    <div class="controls">
      <input id="search" placeholder="Hledat polo≈æky‚Ä¶" />
      <select id="categorySelect"><option value="">Kategorie: v≈°e</option></select>
      <select id="subCategorySelect"><option value="">Podkategorie: v≈°e</option></select>
      <div class="badge" id="countBadge">0 polo≈æek</div>
    </div>

    <div class="grid" id="itemsGrid"></div>
  </section>

  <aside class="aside">
    <h3>Seznam √∫prav</h3>
    <div class="row"><input id="customer" placeholder="Jm√©no mechanika" /></div>
    <div class="row"><input id="vehicle" placeholder="Vozidlo (znaƒçka / SPZ)" /></div>
    <div class="row"><input id="discount" type="number" min="0" max="100" value="0" placeholder="Sleva % (voliteln√©)" /></div>
    <div class="row"><input id="customLabor" type="number" min="0" step="100" value="0" placeholder="Vlastn√≠ pr√°ce (voliteln√©) kƒç" /></div>
    <small class="small">Polo≈æka <em>Oprava vozidla</em> se √∫ƒçtuje p≈ôes ‚ÄûVlastn√≠ pr√°ci‚Äú.</small>

    <div class="cart-list" id="cartList"></div>

    <div class="totals">
      <div class="small">Souƒçet polo≈æek</div><div id="sumPrice">0 Kƒç</div>
      <div class="small">Souƒçet zisku</div><div id="sumProfit">0 Kƒç</div>
      <div class="small">Pod√≠l firmƒõ</div><div id="sumFirm">0 Kƒç</div>
      <div class="small">Vlastn√≠ pr√°ce</div><div id="sumLabor">0 Kƒç</div>
      <div class="small"><strong>Mezisouƒçet</strong></div><div id="subTotal"><strong>0 Kƒç</strong></div>
      <div class="small">Sleva</div><div id="discountValue">0 Kƒç</div>
      <div class="small"><strong>Celkem k √∫hradƒõ</strong></div><div id="grandTotal"><strong>0 Kƒç</strong></div>
    </div>

    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
      <button id="sendBtn">Odeslat do Discordu</button>
      <button class="ghost" id="clearBtn">Vymazat ko≈°√≠k</button>
      <div class="status" id="status"></div>
    </div>

    <div class="small">üü• Neleg√°ln√≠ √∫prava ¬∑ üüß ƒå√°steƒçnƒõ neleg√°ln√≠</div>
  </aside>
</main>

<script>
// webhook (vlo≈æit sv≈Øj url)
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1420174017729527848/WN4MkGTDvKSAIGnvJsf1tTfmO2HXKcxsiphHpOHobf7LhnfvB_vI58OFty1ehVAwmtoV";

// utility
const currency = n => (n===null||n===undefined) ? "‚Äî" : n.toLocaleString('cs-CZ') + " Kƒç";
const UID = (()=>{let id=0; return ()=>++id;})();

// full ITEMS dataset (from user's list)
const ITEMS = [
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"P≈ôebarven√≠ vozidla", price:40000, profit:19200, firm:12800 },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"V√Ωmƒõna svƒõtel", price:15000, profit:6000, firm:4000, semi:true },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"P≈ô√≠d√°n√≠ ƒçi odebr√°n√≠ zatmaven√≠ oken", price:20000, profit:10800, firm:7200 },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"Vystaven√≠ protokolu", price:10000, profit:3000, firm:2000 },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"V√Ωmƒõna kola", price:5000, profit:2880, firm:1920 },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"Oprava vozidla (individu√°ln√≠ nacenƒõn√≠)", price:0, profit:0, firm:0, note:"Cenu urƒç√≠ mechanik." },
{ id:UID(), cat:"Z√°kladn√≠ √∫pravy", name:"Protokol", price:10000, profit:3000, firm:2000 },

// Karoserie
{ id:UID(), cat:"Karoserie", name:"Origin√°ln√≠", price:40000, profit:10800, firm:7200 },
{ id:UID(), cat:"Karoserie", name:"Odlehƒçen√≠", price:130000, profit:30000, firm:20000 },
{ id:UID(), cat:"Karoserie", name:"Zpevnƒõn√≠", price:200000, profit:33000, firm:22000 },

// Kola
{ id:UID(), cat:"Kola", sub:"origin√°ln√≠", name:"Origin√°ln√≠ kola", price:35000, profit:6000, firm:4000 },
{ id:UID(), cat:"Kola", sub:"offroad", name:"Zenden (offroad)", price:60000, profit:15600, firm:10400 },
{ id:UID(), cat:"Kola", sub:"shadow", name:"Shadow (shadow)", price:60000, profit:16800, firm:11200 },
{ id:UID(), cat:"Kola", sub:"mega", name:"Mega (mega)", price:80000, profit:19200, firm:12800 },
{ id:UID(), cat:"Kola", sub:"rimshine", name:"Ronal Turbo (rimshine)", price:90000, profit:16800, firm:11200 },
{ id:UID(), cat:"Kola", sub:"wires", name:"Wires (wires)", price:90000, profit:18600, firm:12400 },
{ id:UID(), cat:"Kola", sub:"classic", name:"Hamann Edition Race (classic)", price:90000, profit:21000, firm:14000 },
{ id:UID(), cat:"Kola", sub:"twist", name:"Seikel (twist)", price:60000, profit:19200, firm:12800 },
{ id:UID(), cat:"Kola", sub:"cutter", name:"Cutter (cutter)", price:80000, profit:19500, firm:13000 },
{ id:UID(), cat:"Kola", sub:"switch", name:"Advan Racing (switch)", price:60000, profit:13200, firm:8800 },
{ id:UID(), cat:"Kola", sub:"grove", name:"Vette (grove)", price:90000, profit:19200, firm:12800 },
{ id:UID(), cat:"Kola", sub:"import", name:"Rays Volk Racing (import)", price:80000, profit:17400, firm:11600 },
{ id:UID(), cat:"Kola", sub:"dollar", name:"DUB Big Chips (dollar)", price:100000, profit:18000, firm:12000 },
{ id:UID(), cat:"Kola", sub:"trance", name:"Bordet (trance)", price:90000, profit:16380, firm:10920 },
{ id:UID(), cat:"Kola", sub:"atomic", name:"BBS (atomic)", price:100000, profit:20400, firm:13600 },
{ id:UID(), cat:"Kola", sub:"ahab", name:"Fifteen52 (ahab)", price:80000, profit:21000, firm:14000 },
{ id:UID(), cat:"Kola", sub:"virtual", name:"AMG1 (virtual)", price:120000, profit:18000, firm:12000 },
{ id:UID(), cat:"Kola", sub:"access", name:"BFGoodrich (access)", price:60000, profit:16200, firm:10800 },

// ≈†√≠≈ôka pneu
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"Origin√°l", price:30000, profit:10800, firm:7200 },
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"Velmi √∫zk√°", price:30000, profit:10800, firm:7200 },
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"√özk√°", price:40000, profit:15600, firm:10400 },
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"Bƒõ≈æn√°", price:45000, profit:16200, firm:10800 },
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"≈†irok√°", price:55000, profit:16800, firm:11200 },
{ id:UID(), cat:"≈†√≠≈ôka pneu", name:"Velmi ≈°irok√°", price:75000, profit:19800, firm:13200 },

// ≈ò√≠d√≠c√≠ jednotka
{ id:UID(), cat:"≈ò√≠d√≠c√≠ jednotka", name:"Tov√°rn√≠ nastaven√≠", price:10000, profit:3000, firm:2000 },
{ id:UID(), cat:"≈ò√≠d√≠c√≠ jednotka", name:"√öprava ECU - v√Ωkon", price:50000, profit:8400, firm:5600 },
{ id:UID(), cat:"≈ò√≠d√≠c√≠ jednotka", name:"√öprava ECU - spot≈ôeba", price:30000, profit:9000, firm:6000 },

// Omezovaƒç
{ id:UID(), cat:"Omezovaƒç", name:"Tov√°rn√≠ nastaven√≠", price:10000, profit:3000, firm:2000 },
{ id:UID(), cat:"Omezovaƒç", name:"≈Ω√°dn√Ω omezovaƒç", price:50000, profit:11400, firm:7600 },
{ id:UID(), cat:"Omezovaƒç", name:"Omezovaƒç 70km/h", price:30000, profit:9600, firm:6400 },
{ id:UID(), cat:"Omezovaƒç", name:"Omezovaƒç 90km/h", price:35000, profit:11400, firm:7600 },
{ id:UID(), cat:"Omezovaƒç", name:"Omezovaƒç 120km/h", price:40000, profit:13200, firm:8800 },
{ id:UID(), cat:"Omezovaƒç", name:"Omezovaƒç 180km/h", price:45000, profit:15000, firm:10000 },
{ id:UID(), cat:"Omezovaƒç", name:"Omezovaƒç 250km/h", price:50000, profit:15000, firm:10000 },

// Motor
{ id:UID(), cat:"Motor", name:"Origin√°ln√≠ motor", price:50000, profit:13200, firm:8800 },
{ id:UID(), cat:"Motor", name:"Zlep≈°en√Ω rozvod paliva", price:100000, profit:33000, firm:22000 },
{ id:UID(), cat:"Motor", name:"Motor s kompresorem", price:170000, profit:33000, firm:22000 },
{ id:UID(), cat:"Motor", name:"Motor s turbem", price:250000, profit:54000, firm:36000 },
{ id:UID(), cat:"Motor", name:"Motor s twin-turbem", price:480000, profit:64800, firm:43200, illegal:true },

// Z√°mek ot√°ƒçen√≠
{ id:UID(), cat:"Z√°mek ot√°ƒçen√≠", name:"Standardn√≠ z√°mek ot√°ƒçen√≠", price:30000, profit:7200, firm:4800 },
{ id:UID(), cat:"Z√°mek ot√°ƒçen√≠", name:"Sn√≠≈æen√Ω z√°mek ot√°ƒçen√≠ -4", price:60000, profit:18000, firm:12000 },
{ id:UID(), cat:"Z√°mek ot√°ƒçen√≠", name:"Sn√≠≈æen√Ω z√°mek ot√°ƒçen√≠ -8", price:90000, profit:18000, firm:12000 },
{ id:UID(), cat:"Z√°mek ot√°ƒçen√≠", name:"Zv√Ω≈°en√Ω z√°mek ot√°ƒçen√≠ +4", price:60000, profit:18000, firm:12000 },
{ id:UID(), cat:"Z√°mek ot√°ƒçen√≠", name:"Zv√Ω≈°en√Ω z√°mek ot√°ƒçen√≠ +8", price:90000, profit:18000, firm:12000 },

// Spoiler
{ id:UID(), cat:"Spoiler", name:"≈Ω√°dn√Ω spoiler", price:20000, profit:9000, firm:6000 },
{ id:UID(), cat:"Spoiler", name:"Spoiler dle vlastn√≠ho v√Ωbƒõru", price:50000, profit:16800, firm:11200 },

// Brzdy
{ id:UID(), cat:"Brzdy", name:"Origin√°ln√≠ brzdy", price:40000, profit:18000, firm:12000 },
{ id:UID(), cat:"Brzdy", name:"Silnƒõj≈°√≠ brzdy", price:120000, profit:27000, firm:18000 },
{ id:UID(), cat:"Brzdy", name:"Se≈ô√≠zen√≠ pro drift", price:100000, profit:30000, firm:20000 },
{ id:UID(), cat:"Brzdy", name:"Zes√≠len√≠ p≈ôedn√≠ch brzd T1", price:150000, profit:24000, firm:16000 },
{ id:UID(), cat:"Brzdy", name:"Zes√≠len√≠ p≈ôedn√≠ch brzd T2", price:300000, profit:30000, firm:20000 },
{ id:UID(), cat:"Brzdy", name:"Zes√≠len√≠ zadn√≠ch brzd T1", price:150000, profit:24000, firm:16000 },
{ id:UID(), cat:"Brzdy", name:"Zes√≠len√≠ zadn√≠ch brzd T2", price:300000, profit:30000, firm:20000 },

// Diferenci√°l
{ id:UID(), cat:"Diferenci√°l", name:"Origin√°ln√≠ diferenci√°l", price:40000, profit:9600, firm:6400 },
{ id:UID(), cat:"Diferenci√°l", name:"Zava≈ôen√Ω diferenci√°l", price:30000, profit:12000, firm:8000, illegal:true },
{ id:UID(), cat:"Diferenci√°l", name:"Samosvorn√Ω diferenci√°l 1-WAY", price:110000, profit:27600, firm:18400 },
{ id:UID(), cat:"Diferenci√°l", name:"Samosvorn√Ω diferenci√°l 1.5-WAY", price:110000, profit:27600, firm:18400 },
{ id:UID(), cat:"Diferenci√°l", name:"Samosvorn√Ω diferenci√°l 2-WAY", price:110000, profit:27600, firm:18400 },

// Geometrie
{ id:UID(), cat:"Geometrie", name:"Tov√°rn√≠ nastaven√≠", price:10000, profit:5400, firm:3600 },
{ id:UID(), cat:"Geometrie", name:"Se≈ô√≠zen√≠ geometrie T1", price:30000, profit:13800, firm:9200 },
{ id:UID(), cat:"Geometrie", name:"Se≈ô√≠zen√≠ geometrie T2", price:40000, profit:15000, firm:10000 },

// Rozlo≈æen√≠ hmotnosti
{ id:UID(), cat:"Rozlo≈æen√≠ hmotnosti", name:"Origin√°ln√≠ tƒõ≈æi≈°tƒõ", price:40000, profit:12000, firm:8000 },
{ id:UID(), cat:"Rozlo≈æen√≠ hmotnosti", name:"Odlehƒçen√° p≈ôedn√≠ ƒç√°st", price:50000, profit:15000, firm:10000 },
{ id:UID(), cat:"Rozlo≈æen√≠ hmotnosti", name:"Zat√≠≈æen√° zadn√≠ ƒç√°st", price:45000, profit:15000, firm:10000 },
{ id:UID(), cat:"Rozlo≈æen√≠ hmotnosti", name:"Odlehƒçen√° zadn√≠ ƒç√°st", price:50000, profit:15000, firm:10000 },
{ id:UID(), cat:"Rozlo≈æen√≠ hmotnosti", name:"Zat√≠≈æen√° p≈ôedn√≠ ƒç√°st", price:45000, profit:15000, firm:10000 },

// P√°sy
{ id:UID(), cat:"P√°sy", name:"Bƒõ≈æn√© t≈ô√≠bodov√© p√°sy", price:20000, profit:8400, firm:5600 },
{ id:UID(), cat:"P√°sy", name:"Sportovn√≠ ƒçty≈ôbodov√© p√°sy", price:50000, profit:19200, firm:12800 },
{ id:UID(), cat:"P√°sy", name:"Z√°vodn√≠ ≈°estibodov√© p√°sy", price:70000, profit:22800, firm:15200 },

// Ochrann√© prvky
{ id:UID(), cat:"Ochrann√© prvky", name:"≈Ω√°dn√© ochrann√© prvky", price:30000, profit:9000, firm:6000 },
{ id:UID(), cat:"Ochrann√© prvky", name:"Z√°kladn√≠ bezp. polo-r√°m (ocel)", price:100000, profit:30000, firm:20000 },
{ id:UID(), cat:"Ochrann√© prvky", name:"Z√°kladn√≠ bezp. r√°m (ocel)", price:140000, profit:30000, firm:20000, illegal:true },
{ id:UID(), cat:"Ochrann√© prvky", name:"Bezp. polo-r√°m (brom-molybden)", price:220000, profit:42000, firm:28000 },
{ id:UID(), cat:"Ochrann√© prvky", name:"Bezp. r√°m (ocel)", price:270000, profit:30000, firm:20000, illegal:true },
{ id:UID(), cat:"Ochrann√© prvky", name:"Bezp. r√°m (chrom-molybden)", price:500000, profit:60000, firm:40000, illegal:true },
{ id:UID(), cat:"Ochrann√© prvky", name:"Z√°vodn√≠ bezp. r√°m (chrom-molybden)", price:1000000, profit:120000, firm:80000, illegal:true },

// Ostatn√≠
{ id:UID(), cat:"Ostatn√≠", name:"P≈ôid√°n√≠ / odebr√°n√≠ hydrauliky", price:50000, profit:null, firm:null, note:"Hydraulika p≈ôiprav√≠ vozidlo o ve≈°ker√© off-road vlastnosti ‚Äì z√°kazn√≠ka informujte." }
]; // end ITEMS

// build filters
const grid = document.getElementById('itemsGrid');
const categorySelect = document.getElementById('categorySelect');
const subCategorySelect = document.getElementById('subCategorySelect');
const searchInput = document.getElementById('search');
const countBadge = document.getElementById('countBadge');
const cart = new Map();

function unique(arr){ return [...new Set(arr)].filter(Boolean).sort(); }
function buildFilters(){
  const cats = unique(ITEMS.map(i=>i.cat));
  categorySelect.innerHTML = '<option value="">Kategorie: v≈°e</option>' + cats.map(c=>`<option value="${c}">${c}</option>`).join('');
  buildSubcats();
}
function buildSubcats(){
  const cat = categorySelect.value;
  const subs = unique(ITEMS.filter(i=>!cat||i.cat===cat).map(i=>i.sub||""));
  subCategorySelect.innerHTML = '<option value="">Podkategorie: v≈°e</option>' + subs.filter(Boolean).map(s=>`<option value="${s}">${s}</option>`).join('');
}

function filteredItems(){
  const q = (searchInput.value||"").toLowerCase();
  const cat = categorySelect.value;
  const sub = subCategorySelect.value;
  return ITEMS.filter(i=> (!cat||i.cat===cat) && (!sub|| (i.sub||"")===sub) && (i.name.toLowerCase().includes(q) || i.cat.toLowerCase().includes(q) || (i.sub||"").toLowerCase().includes(q)) );
}

function render(){
  const items = filteredItems();
  countBadge.textContent = items.length + " polo≈æek";
  grid.innerHTML = items.map(i=>{
    const flags = `${i.illegal?'<span class="pill illegal">üü• Ileg√°ln√≠</span>':''}${i.semi?'<span class="pill semi">üüß ƒå√°steƒçnƒõ neleg√°ln√≠</span>':''}`;
    const sub = i.sub?`<span class="pill">${i.sub}</span>`:'';
    const note = i.note?`<div class="small">${i.note}</div>`:'';
    return `<div class="card">
      <h3>${i.name}</h3>
      <div class="meta"><span class="pill">${i.cat}</span>${sub}${flags}</div>
      <div class="price">Cena: ${currency(i.price)}</div>
      <div class="meta"><span class="pill">Zisk: ${currency(i.profit)}</span><span class="pill">Firma: ${currency(i.firm)}</span></div>
      ${note}
      <div class="actions">
        <input class="qty" id="qty_${i.id}" type="number" min="1" value="1">
        <button onclick="addToCart(${i.id})">P≈ôidat</button>
      </div>
    </div>`;
  }).join('');
  renderCart();
}

function addToCart(id){
  const item = ITEMS.find(x=>x.id===id);
  if(!item) return;
  const qtyInput = document.getElementById('qty_'+id);
  const qty = parseInt(qtyInput?.value||"1");
  const key = String(id);
  if(cart.has(key)){
    const entry = cart.get(key);
    entry.qty += qty;
  } else {
    cart.set(key, { item, qty });
  }
  renderCart();
}

function removeFromCart(key){
  cart.delete(key);
  renderCart();
}

function renderCart(){
  const list = document.getElementById('cartList');
  const arr = [...cart.entries()];
  if(arr.length===0){
    list.innerHTML = '<div class="small">Zoznam je pr√°zdn√Ω.</div>';
  } else {
    list.innerHTML = arr.map(([key,{item,qty}])=>`
      <div class="cart-item">
        <div>
          <div><strong>${item.name}</strong> √ó ${qty}</div>
          <div class="sub">${item.cat}${item.sub? ' ‚Ä¢ '+item.sub:''}${item.illegal? ' ‚Ä¢ üü•':''}${item.semi? ' ‚Ä¢ üüß':''}</div>
        </div>
        <div style="text-align:right">
          <div class="sub">${currency((item.price||0)*qty)}</div>
          <div style="margin-top:6px"><button class="ghost" onclick="removeFromCart('${key}')">Smazat</button></div>
        </div>
      </div>
    `).join('');
  }

  const customLabor = parseInt(document.getElementById('customLabor').value||"0");
  const discountPct = parseFloat(document.getElementById('discount').value||"0");

  let sumPrice=0,sumProfit=0,sumFirm=0;
  arr.forEach(([_,{item,qty}])=>{
    sumPrice += (item.price||0) * qty;
    sumProfit += (item.profit||0) * qty;
    sumFirm += (item.firm||0) * qty;
  });
  const subtotal = sumPrice + customLabor;
  const discount = Math.round(subtotal * (discountPct/100));
  const grand = subtotal - discount;

  document.getElementById('sumPrice').textContent = currency(sumPrice);
  document.getElementById('sumProfit').textContent = currency(sumProfit);
  document.getElementById('sumFirm').textContent = currency(sumFirm);
  document.getElementById('sumLabor').textContent = currency(customLabor);
  document.getElementById('subTotal').innerHTML = '<strong>'+currency(subtotal)+'</strong>';
  document.getElementById('discountValue').textContent = '- ' + currency(discount);
  document.getElementById('grandTotal').innerHTML = '<strong>'+currency(grand)+'</strong>';
}

// events
document.getElementById('search').addEventListener('input', render);
categorySelect.addEventListener('change', ()=>{ buildSubcats(); render(); });
subCategorySelect.addEventListener('change', render);
document.getElementById('discount').addEventListener('input', renderCart);
document.getElementById('customLabor').addEventListener('input', renderCart);
document.getElementById('clearBtn').addEventListener('click', ()=>{ cart.clear(); renderCart(); });

// send to discord
async function sendToDiscord(){
  const status = document.getElementById('status');
  if(!DISCORD_WEBHOOK){ status.innerHTML = '<span style="color:#ffcccb">Vlo≈æ WEBHOOK URL do k√≥du.</span>'; return; }
  const customer = document.getElementById('customer').value || 'Nezad√°no';
  const vehicle = document.getElementById('vehicle').value || 'Nezad√°no';
  const labor = parseInt(document.getElementById('customLabor').value||"0");
  const discountPct = parseFloat(document.getElementById('discount').value||"0");
  const items = [...cart.values()].map(({item,qty})=>({
    name:item.name, cat:item.cat, sub:item.sub||'', qty,
    price:(item.price||0)*qty, profit:(item.profit||0)*qty, firm:(item.firm||0)*qty, flags:item.illegal?'üü•':''
  }));
  let sumPrice=0,sumProfit=0,sumFirm=0;
  items.forEach(i=>{ sumPrice+=i.price; sumProfit+=i.profit; sumFirm+=i.firm; });
  const subtotal = sumPrice + labor;
  const discount = Math.round(subtotal * (discountPct/100));
  const total = subtotal - discount;
  const lines = items.map(i=>`‚Ä¢ ${i.name} √ó ${i.qty} (${i.cat}${i.sub? ' ‚Ä¢ '+i.sub:''}) ${i.flags} ‚Äì ${i.price.toLocaleString('cs-CZ')} Kƒç`).join("\n") || '‚Äî';
  const embed = {
    title: "Z√°znam √∫prav ‚Äì AIC",
    color: 0x24a0ff,
    fields: [
      {name:"Mechanik", value:customer, inline:true},
      {name:"Vozidlo", value:vehicle, inline:true},
      {name:"Polo≈æky", value:lines, inline:false},
      {name:"Souƒçet polo≈æek", value: sumPrice.toLocaleString('cs-CZ')+" Kƒç", inline:true},
      {name:"Firemn√≠ zisk", value: sumFirm.toLocaleString('cs-CZ')+" Kƒç", inline:true},
      {name:"Vlastn√≠ pr√°ce", value: labor.toLocaleString('cs-CZ')+" Kƒç", inline:true},
      {name:"Sleva", value: "-"+discount.toLocaleString('cs-CZ')+" Kƒç", inline:true},
      {name:"Celkem k √∫hradƒõ", value: total.toLocaleString('cs-CZ')+" Kƒç", inline:false},
    ],
  };
  try{
    const res = await fetch(DISCORD_WEBHOOK,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[embed]})});
    if(res.ok){ status.innerHTML='<span style="color:#b6f5d0">‚úÖ Odesl√°no</span>'; cart.clear(); renderCart(); }
    else { status.innerHTML='<span style="color:#ffcccb">Chyba webhooku: '+res.status+'</span>'; }
  }catch(e){ status.innerHTML='<span style="color:#ffcccb">Chyba: '+e.message+'</span>'; }
}
document.getElementById('sendBtn').addEventListener('click', sendToDiscord);
buildFilters(); render();
</script>
</body>
</html>
